# Requirements Document

## Introduction

This specification addresses two critical bugs in the AceMind application that prevent core functionality from working properly:

1. **Planner Button Issue**: The "Generate AI Study Plan" button remains disabled even when all required form inputs are provided
2. **Visual Roadmap Issue**: The visual roadmap displays raw HTML/JavaScript code in a popup window instead of rendering the interactive mind map visualization, with JavaScript errors: "Uncaught SyntaxError: Invalid or unexpected token" and "Uncaught ReferenceError: downloadHTML is not defined"

## Glossary

- **Planner Component**: The React component (`Planner.tsx`) that allows users to create AI-generated study plans
- **Roadmap Component**: The React component (`Roadmap.tsx`) that generates learning roadmaps with visual mind maps
- **Study Plan Input State**: The React state object (`studyPlanInput`) that stores form data for generating study plans
- **Visual Roadmap**: An interactive HTML mind map visualization generated by the backend and displayed in a popup window
- **Backend API**: The FastAPI server that processes requests and generates content
- **Form State Synchronization**: The process of keeping local form state in sync with the state used for validation

## Requirements

### Requirement 1: Fix Planner Button State Management

**User Story:** As a student, I want to be able to generate an AI study plan after filling in all required fields, so that I can create a personalized study schedule.

#### Acceptance Criteria

1. WHEN the user enters daily study hours, THEN the Planner Component SHALL update the `studyPlanInput.daily_study_hours` state with the entered value
2. WHEN the user selects an exam date, THEN the Planner Component SHALL update the `studyPlanInput.exam_date` state with the selected date
3. WHEN the user enters study goals, THEN the Planner Component SHALL update the `studyPlanInput.goals` state with the entered text
4. WHEN the user adds at least one subject AND sets an exam date, THEN the Planner Component SHALL enable the "Generate AI Study Plan" button
5. WHEN all required fields are populated, THEN the Planner Component SHALL allow the user to click the generate button and create a study plan

### Requirement 2: Fix Visual Roadmap HTML Rendering

**User Story:** As a learner, I want to view my learning roadmap as an interactive visual mind map, so that I can understand the learning path structure at a glance.

#### Acceptance Criteria

1. WHEN the backend generates visual roadmap HTML, THEN the Backend API SHALL ensure all JavaScript functions are properly defined before they are referenced
2. WHEN the visual roadmap HTML is generated, THEN the Backend API SHALL ensure the `downloadHTML` function is defined before any onclick handlers reference it
3. WHEN the visual roadmap HTML contains script tags, THEN the Backend API SHALL ensure proper JavaScript syntax without unexpected tokens
4. WHEN the user clicks "Visual Map" button, THEN the Roadmap Component SHALL open a popup window that renders the interactive mind map correctly
5. WHEN the visual roadmap loads in the popup, THEN the Roadmap Component SHALL display the mind map visualization without JavaScript errors

### Requirement 3: Validate Backend HTML Generation

**User Story:** As a developer, I want the backend to generate valid HTML with properly structured JavaScript, so that the frontend can display visualizations without errors.

#### Acceptance Criteria

1. WHEN the backend generates HTML content, THEN the Backend API SHALL validate that all JavaScript functions are defined in the correct order
2. WHEN the backend includes onclick handlers in HTML, THEN the Backend API SHALL ensure the referenced functions exist in the script section
3. WHEN the backend creates script tags, THEN the Backend API SHALL ensure proper escaping of special characters to prevent syntax errors
4. WHEN the backend returns HTML content, THEN the Backend API SHALL return valid, well-formed HTML that can be rendered in a browser
5. IF the backend encounters an error during HTML generation, THEN the Backend API SHALL return a proper error response instead of malformed HTML
